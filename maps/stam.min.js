!function(e){"function"==typeof define&&define.amd?define(["core-js/modules/es.symbol","core-js/modules/es.symbol.description","core-js/modules/es.symbol.iterator","core-js/modules/es.array.concat","core-js/modules/es.array.filter","core-js/modules/es.array.flat","core-js/modules/es.array.for-each","core-js/modules/es.array.from","core-js/modules/es.array.index-of","core-js/modules/es.array.iterator","core-js/modules/es.array.join","core-js/modules/es.array.map","core-js/modules/es.array.slice","core-js/modules/es.array.unscopables.flat","core-js/modules/es.function.name","core-js/modules/es.math.sign","core-js/modules/es.number.to-fixed","core-js/modules/es.object.to-string","core-js/modules/es.promise","core-js/modules/es.regexp.exec","core-js/modules/es.regexp.to-string","core-js/modules/es.string.iterator","core-js/modules/es.string.split","core-js/modules/web.dom-collections.for-each","core-js/modules/web.dom-collections.iterator","core-js/modules/es.symbol.async-iterator","core-js/modules/es.symbol.to-string-tag","core-js/modules/es.json.to-string-tag","core-js/modules/es.math.to-string-tag","core-js/modules/es.object.get-prototype-of","core-js/modules/es.object.keys","core-js/modules/es.array.find","core-js/modules/es.array.includes","core-js/modules/es.array.some","core-js/modules/es.number.constructor","core-js/modules/es.reflect.construct","core-js/modules/es.string.includes","core-js/modules/es.reflect.own-keys"],e):e()}((function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&r.path)}},r.exports),r.exports}function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}t((function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var o=t&&t.prototype instanceof p?t:p,i=Object.create(o.prototype),a=new L(n||[]);return i._invoke=function(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return O()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=x(a,r);if(s){if(s===f)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=c(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===f)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}(e,r,a),i}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var f={};function p(){}function h(){}function d(){}var y={};y[i]=function(){return this};var m=Object.getPrototypeOf,g=m&&m(m(_([])));g&&g!==t&&n.call(g,i)&&(y=g);var v=d.prototype=p.prototype=Object.create(y);function b(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){var o;this._invoke=function(i,a){function s(){return new t((function(o,s){!function o(i,a,s,l){var u=c(e[i],e,a);if("throw"!==u.type){var f=u.arg,p=f.value;return p&&"object"===r(p)&&n.call(p,"__await")?t.resolve(p.__await).then((function(e){o("next",e,s,l)}),(function(e){o("throw",e,s,l)})):t.resolve(p).then((function(e){f.value=e,s(f)}),(function(e){return o("throw",e,s,l)}))}l(u.arg)}(i,a,o,s)}))}return o=o?o.then(s,s):s()}}function x(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method))return f;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,f;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function _(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:O}}function O(){return{value:void 0,done:!0}}return h.prototype=v.constructor=d,d.constructor=h,h.displayName=l(d,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,l(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},b(w.prototype),w.prototype[a]=function(){return this},e.AsyncIterator=w,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new w(u(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},b(v),l(v,s,"Generator"),v[i]=function(){return this},v.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=_,L.prototype={constructor:L,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(s&&l){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:_(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}));function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=t((function(t){var r,o;r=e,o=function(){function e(e){return"object"===("undefined"==typeof Node?"undefined":n(Node))?e instanceof Node:e&&"object"===n(e)&&"number"==typeof e.nodeType}function t(){var e=[];return{watch:e.push.bind(e),trigger:function(t,r){for(var n=!0,o={detail:r,preventDefault:function(){n=!1}},i=0;i<e.length;i++)e[i](t,o);return n}}}function r(e){return"none"===window.getComputedStyle(e).display}function o(e){this.elem=e}function i(e,t){return o.make(e("parent")).clazz("pico-overlay").clazz(e("overlayClass","")).stylize({display:"none",position:"fixed",top:"0px",left:"0px",height:"100%",width:"100%",zIndex:1e4}).stylize(e("overlayStyles",{opacity:.5,background:"#000"})).onClick((function(){e("overlayClose",!0)&&t()}))}o.make=function(e,t){"string"==typeof e&&(e=document.querySelector(e));var r=document.createElement(t||"div");return(e||document.body).appendChild(r),new o(r)},o.prototype={child:function(e){return o.make(this.elem,e)},stylize:function(e){for(var t in void 0!==(e=e||{}).opacity&&(e.filter="alpha(opacity="+100*e.opacity+")"),e)e.hasOwnProperty(t)&&(this.elem.style[t]=e[t]);return this},clazz:function(e){return this.elem.className+=" "+e,this},html:function(t){return e(t)?this.elem.appendChild(t):this.elem.innerHTML=t,this},onClick:function(e){return this.elem.addEventListener("click",e),this},destroy:function(){this.elem.parentNode.removeChild(this.elem)},hide:function(){this.elem.style.display="none"},show:function(){this.elem.style.display="block"},attr:function(e,t){return void 0!==t&&this.elem.setAttribute(e,t),this},anyAncestor:function(e){for(var t=this.elem;t;){if(e(new o(t)))return!0;t=t.parentNode}return!1},isVisible:function(){return!r(this.elem)}};var a=1;function s(e,t){if(t("closeButton",!0))return e.child("button").html(t("closeHtml","&#xD7;")).clazz("pico-close").clazz(t("closeClass","")).stylize(t("closeStyles",{borderRadius:"2px",border:0,padding:0,cursor:"pointer",height:"15px",width:"15px",position:"absolute",top:"5px",right:"5px",fontSize:"16px",textAlign:"center",lineHeight:"15px",background:"#CCC"})).attr("aria-label",t("close-label","Close"))}function l(e){return function(){return e().elem}}var u=t(),c=t();function f(e,t){function n(e,t){return(e.msMatchesSelector||e.webkitMatchesSelector||e.matches).call(e,t)}function o(e){return!(r(e)||n(e,":disabled")||e.hasAttribute("contenteditable"))&&(e.hasAttribute("tabindex")||n(e,"input,select,textarea,button,a[href],area[href],iframe"))}function i(e){for(var t=e.getElementsByTagName("*"),r=0;r<t.length;r++)if(o(t[r]))return t[r]}var a;e.beforeShow((function(){a=document.activeElement})),e.afterShow((function(){if(t()){var r=i(e.modalElem());r&&r.focus()}})),e.afterClose((function(){t()&&a&&a.focus(),a=null})),c.watch((function(r){if(t()&&e.isVisible()){var n=i(e.modalElem()),a=function(e){for(var t=e.getElementsByTagName("*"),r=t.length;r--;)if(o(t[r]))return t[r]}(e.modalElem());(r.shiftKey?n:a)===document.activeElement&&((r.shiftKey?a:n).focus(),r.preventDefault())}}))}return document.documentElement.addEventListener("keydown",(function(e){var t=e.which||e.keyCode;27===t?u.trigger():9===t&&c.trigger(e)})),function(r){("string"==typeof r||e(r))&&(r={content:r});var n=t(),c=t(),p=t(),h=t(),d=t();function y(e,t){var n=r[e];return"function"==typeof n&&(n=n(t)),void 0===n?t:n}var m,g,v=L.bind(window,"modal"),b=L.bind(window,"overlay"),w=L.bind(window,"close");function x(e){b().hide(),v().hide(),d.trigger(m,e)}function S(e){h.trigger(m,e)&&x(e)}function k(e){return function(){return e.apply(this,arguments),m}}function L(e,t){if(!g){var r=function(e,t){var r=e("width","auto");"number"==typeof r&&(r+="px");var n=e("modalId","pico-"+a++);return o.make(e("parent")).clazz("pico-content").clazz(e("modalClass","")).stylize({display:"none",position:"fixed",zIndex:10001,left:"50%",top:"38.1966%",maxHeight:"90%",boxSizing:"border-box",width:r,"-ms-transform":"translate(-50%,-38.1966%)","-moz-transform":"translate(-50%,-38.1966%)","-webkit-transform":"translate(-50%,-38.1966%)","-o-transform":"translate(-50%,-38.1966%)",transform:"translate(-50%,-38.1966%)"}).stylize(e("modalStyles",{overflow:"auto",backgroundColor:"white",padding:"20px",borderRadius:"5px"})).html(e("content")).attr("id",n).attr("role","dialog").attr("aria-labelledby",e("ariaLabelledBy")).attr("aria-describedby",e("ariaDescribedBy",n)).onClick((function(e){new o(e.target).anyAncestor((function(e){return/\bpico-close\b/.test(e.elem.className)}))&&t()}))}(y,S);g={modal:r,overlay:i(y,S),close:s(r,y)},n.trigger(m,t)}return g[e]}return f(m={modalElem:l(v),closeElem:l(w),overlayElem:l(b),buildDom:k(L.bind(null,null)),isVisible:function(){return!!(g&&v&&v().isVisible())},show:function(e){return c.trigger(m,e)&&(b().show(),w(),v().show(),p.trigger(m,e)),this},close:k(S),forceClose:k(x),destroy:function(){v().destroy(),b().destroy(),b=v=w=void 0},options:function(e){Object.keys(e).map((function(t){r[t]=e[t]}))},afterCreate:k(n.watch),beforeShow:k(c.watch),afterShow:k(p.watch),beforeClose:k(h.watch),afterClose:k(d.watch)},y.bind(null,"focus",!0)),function(e,t){var r,n=new o(document.body);e.beforeShow((function(){r=n.elem.style.overflow,t()&&n.stylize({overflow:"hidden"})})),e.afterClose((function(){n.stylize({overflow:r})}))}(m,y.bind(null,"bodyOverflow",!0)),u.watch((function(){y("escCloses",!0)&&m.isVisible()&&m.close()})),m}},t.exports?t.exports=o():r.picoModal=o()})),i=null;function a(e){switch(e){case"green":return i.greenIcon;case"black":return i.blackIcon;case"blue":return i.blueIcon;case"grey":return i.greyIcon;case"violet":return i.violetIcon;case"yellow":return i.yellowIcon;case"red":return i.redIcon;case"orange":return i.orangeIcon;case"gold":return i.goldIcon;default:return new L.Icon.Default}}function s(){}function l(){l.init.call(this)}function u(e){return void 0===e._maxListeners?l.defaultMaxListeners:e._maxListeners}function c(e,t,r){if(t)e.call(r);else for(var n=e.length,o=v(e,n),i=0;i<n;++i)o[i].call(r)}function f(e,t,r,n){if(t)e.call(r,n);else for(var o=e.length,i=v(e,o),a=0;a<o;++a)i[a].call(r,n)}function p(e,t,r,n,o){if(t)e.call(r,n,o);else for(var i=e.length,a=v(e,i),s=0;s<i;++s)a[s].call(r,n,o)}function h(e,t,r,n,o,i){if(t)e.call(r,n,o,i);else for(var a=e.length,s=v(e,a),l=0;l<a;++l)s[l].call(r,n,o,i)}function d(e,t,r,n){if(t)e.apply(r,n);else for(var o=e.length,i=v(e,o),a=0;a<o;++a)i[a].apply(r,n)}function y(e,t,r,n){var o,i,a,l;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((i=e._events)?(i.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),i=e._events),a=i[t]):(i=e._events=new s,e._eventsCount=0),a){if("function"==typeof a?a=i[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),!a.warned&&(o=u(e))&&o>0&&a.length>o){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=a.length,l=c,"function"==typeof console.warn?console.warn(l):console.log(l)}}else a=i[t]=r,++e._eventsCount;return e}function m(e,t,r){var n=!1;function o(){e.removeListener(t,o),n||(n=!0,r.apply(e,arguments))}return o.listener=r,o}function g(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function v(e,t){for(var r=new Array(t);t--;)r[t]=e[t];return r}function b(e,t){if(e!==t)throw new TypeError("Cannot instantiate an arrow function")}function w(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}"undefined"!=typeof L&&(i={blueIcon:new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png",shadowUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),goldIcon:new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-gold.png",shadowUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),redIcon:new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png",shadowUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),greenIcon:new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",shadowUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),orangeIcon:new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-orange.png",shadowUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),yellowIcon:new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-yellow.png",shadowUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),violetIcon:new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-violet.png",shadowUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),greyIcon:new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-grey.png",shadowUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),blackIcon:new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-black.png",shadowUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]})}),s.prototype=Object.create(null),l.EventEmitter=l,l.usingDomains=!1,l.prototype.domain=void 0,l.prototype._events=void 0,l.prototype._maxListeners=void 0,l.defaultMaxListeners=10,l.init=function(){this.domain=null,l.usingDomains&&(void 0).active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new s,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},l.prototype.getMaxListeners=function(){return u(this)},l.prototype.emit=function(e){var t,r,n,o,i,a,s,l="error"===e;if(a=this._events)l=l&&null==a.error;else if(!l)return!1;if(s=this.domain,l){if(t=arguments[1],!s){if(t instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=s,t.domainThrown=!1,s.emit("error",t),!1}if(!(r=a[e]))return!1;var y="function"==typeof r;switch(n=arguments.length){case 1:c(r,y,this);break;case 2:f(r,y,this,arguments[1]);break;case 3:p(r,y,this,arguments[1],arguments[2]);break;case 4:h(r,y,this,arguments[1],arguments[2],arguments[3]);break;default:for(o=new Array(n-1),i=1;i<n;i++)o[i-1]=arguments[i];d(r,y,this,o)}return!0},l.prototype.addListener=function(e,t){return y(this,e,t,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(e,t){return y(this,e,t,!0)},l.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,m(this,e,t)),this},l.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,m(this,e,t)),this},l.prototype.removeListener=function(e,t){var r,n,o,i,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(r=n[e]))return this;if(r===t||r.listener&&r.listener===t)0==--this._eventsCount?this._events=new s:(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(o=-1,i=r.length;i-- >0;)if(r[i]===t||r[i].listener&&r[i].listener===t){a=r[i].listener,o=i;break}if(o<0)return this;if(1===r.length){if(r[0]=void 0,0==--this._eventsCount)return this._events=new s,this;delete n[e]}else!function(e,t){for(var r=t,n=r+1,o=e.length;n<o;r+=1,n+=1)e[r]=e[n];e.pop()}(r,o);n.removeListener&&this.emit("removeListener",e,a||t)}return this},l.prototype.removeAllListeners=function(e){var t,r;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=new s,this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=new s:delete r[e]),this;if(0===arguments.length){for(var n,o=Object.keys(r),i=0;i<o.length;++i)"removeListener"!==(n=o[i])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=new s,this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},l.prototype.listeners=function(e){var t,r=this._events;return r&&(t=r[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(t):[]},l.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):g.call(e,t)},l.prototype.listenerCount=g,l.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var x=function(){function e(t){var r,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o=void 0,(n="queryObject")in(r=this)?Object.defineProperty(r,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[n]=o,this.queryObject=t}var t,r,n;return t=e,(r=[{key:"toString",value:function(){var t=this,r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=this.queryObject.entityType,o=[];if(this.queryObject.id){if(!r)return"".concat(this.queryObject.entityType,"(").concat(this.queryObject.id,")");n="".concat(n,"(").concat(this.queryObject.id,")"),delete this.queryObject.id}for(var i in this.queryObject.pathSuffix&&(n="".concat(n,"/").concat(this.queryObject.pathSuffix)),this.queryObject)(this.queryObject[i]||0==this.queryObject[i])&&("select"!=i?"expand"!=i?"entityType"!=i&&"pathSuffix"!=i&&o.push("$".concat(i,"=").concat(this.queryObject[i].toString())):o.push("$expand=".concat(this.queryObject.expand.map(function(r){return b(this,t),new e(r).toString(!1)}.bind(this)).join(","))):o.push("$select=".concat(this.queryObject.select.join(","))));return 0==o.length?n:r?"".concat(n,"?").concat(o.join("&")):"".concat(n,"(").concat(o.join(";"),")")}}])&&w(t.prototype,r),n&&w(t,n),e}();function S(e){return function(e){if(Array.isArray(e))return k(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return k(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return k(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function O(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var j=function(){function e(t){var r,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o=void 0,(n="baseUrl")in(r=this)?Object.defineProperty(r,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[n]=o,this.baseUrl=t}var t,r,n;return t=e,(r=[{key:"getGeoJson",value:function(e){var t=this,r=e.top;return null!=e.top&&null!=e.top||(e.top=1e4),e=JSON.parse(JSON.stringify(e)),new Promise(function(){var n,o=(n=regeneratorRuntime.mark((function n(o,i){var a,s,l,u,c,f;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,a="".concat(t.baseUrl,"/").concat(new x(e).toString()),n.next=4,fetch(a);case 4:return n.next=6,n.sent.json();case 6:(s=n.sent).value[0]&&s.value[0].dataArray&&(s.value=s.value[0]),l=s["@iot.nextLink"];case 9:if(!l||!(null==r||s.value.length&&s.value.length<r||s.value.dataArray&&s.value.dataArray.length<r)){n.next=19;break}return n.next=12,fetch(l);case 12:return n.next=14,n.sent.json();case 14:(u=n.sent).value[0]&&u.value[0].dataArray?(c=s.value.dataArray).push.apply(c,S(u.value[0].dataArray)):(f=s.value).push.apply(f,S(u.value)),l=u["@iot.nextLink"],n.next=9;break;case 19:o(s),n.next=25;break;case 22:n.prev=22,n.t0=n.catch(0),i(n.t0);case 25:case"end":return n.stop()}}),n,null,[[0,22]])})),function(){var e=this,t=arguments;return new Promise((function(r,o){var i=n.apply(e,t);function a(e){_(i,r,o,a,s,"next",e)}function s(e){_(i,r,o,a,s,"throw",e)}a(void 0)}))});return function(e,t){return o.apply(this,arguments)}}())}}])&&O(t.prototype,r),n&&O(t,n),e}();function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t){if(e!==t)throw new TypeError("Cannot instantiate an arrow function")}function T(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function P(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){T(i,n,o,a,s,"next",e)}function s(e){T(i,n,o,a,s,"throw",e)}a(void 0)}))}}function A(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return I(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return I(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function M(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function z(e,t){return(z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function N(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=U(e);if(t){var o=U(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return D(this,r)}}function D(e,t){return!t||"object"!==E(t)&&"function"!=typeof t?F(e):t}function F(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function U(e){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function G(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var R,q,J,B,V=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&z(e,t)}(s,e);var t,r,n,o,i,a=N(s);function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),G(F(t=a.call(this)),"config",void 0),G(F(t),"api",void 0),G(F(t),"cache",void 0),t.cache=[],t.config=e,t.api=new j(e.baseUrl),t}return t=s,(r=[{key:"long2tile",value:function(e,t){return Math.floor((e+180)/360*Math.pow(2,t))}},{key:"lat2tile",value:function(e,t){return Math.floor((1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,t))}},{key:"tile2long",value:function(e,t){return e/Math.pow(2,t)*360-180}},{key:"tile2lat",value:function(e,t){var r=Math.PI-2*Math.PI*e/Math.pow(2,t);return 180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))}},{key:"coordinatesToOsm",value:function(e,t){return{lat:this.tile2long(this.long2tile(e.lat,t),t),lng:this.tile2lat(this.lat2tile(e.lng,t),t)}}},{key:"coordinatesToOsmBottom",value:function(e,t){return{lat:this.tile2long(this.long2tile(e.lat,t)+1,t),lng:this.tile2lat(this.lat2tile(e.lng,t)+1,t)}}},{key:"getOSMBoundingBox",value:function(e,t){var r={lat:0,lng:0},n={lat:0,lng:0},o=this.long2tile(t[0],e),i=this.lat2tile(t[1],e);r.lat=this.tile2long(o+1,e),r.lng=this.tile2lat(i,e);var a=this.long2tile(t[2],e),s=this.lat2tile(t[3],e);return n.lat=this.tile2long(a,e),n.lng=this.tile2lat(s+1,e),[r.lat,r.lng,n.lat,n.lng]}},{key:"getQuery",value:function(e){if("entityType"in this.config.queryObject)return this.config.queryObject;var t,r=A(this.config.queryObject);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(isNaN(Number(n.zoomLevel))){var o=n.zoomLevel;if(o.to){if(e>=o.from&&e<=o.to)return n.query}else if(e>=o.from)return n.query}else if(n.zoomLevel==e)return n.query}}catch(e){r.e(e)}finally{r.f()}throw new Error("No Query specified for the zoomLevel: "+e)}},{key:"getLayerData",value:(i=P(regeneratorRuntime.mark((function e(t,r){var n,o,i,a,s,l,u,c,f,p=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.emitChange(t),"Things"!=(n=JSON.parse(JSON.stringify(this.getQuery(t)))).entityType){e.next=7;break}n.select=["id"],n.expand=[{entityType:"Locations"}],e.next=12;break;case 7:if("FeaturesOfInterest"!=n.entityType){e.next=11;break}n.select=["feature"],e.next=12;break;case 11:throw new Error("Only Things and FeaturesOfInterest are supported");case 12:for(n.count=!0,n.top=0,o={lat:this.lat2tile(r[1],t),lng:this.long2tile(r[0],t)},i={lat:this.lat2tile(r[3],t),lng:this.long2tile(r[2],t)},a=[],s=[],l=i.lng;l<=o.lng;l++)for(u=function(){var e=this,r={lat:p.tile2lat(c,t),lng:p.tile2long(l,t)},o={lat:p.tile2lat(c+1,t),lng:p.tile2long(l+1,t)},i=JSON.parse(JSON.stringify(n)),a=H([[[r.lng,r.lat],[r.lng,o.lat],[o.lng,o.lat],[o.lng,r.lat],[r.lng,r.lat]]],i.entityType);i.filter?i.filter="(".concat(i.filter,") and ").concat(a):i.filter=a;var u={type:"Feature",geometry:{type:"Polygon",coordinates:[[[r.lng,r.lat],[r.lng,o.lat],[o.lng,o.lat],[o.lng,r.lat],[r.lng,r.lat]]]},properties:{count:0}};p.getCached(t).features.find(function(t){return C(this,e),W(u,t)}.bind(this))||s.push(new Promise(function(){var e=P(regeneratorRuntime.mark((function e(r,n){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!p.config.cluster&&null!=p.config.cluster){e.next=22;break}return e.prev=1,e.next=4,p.api.getGeoJson(i);case 4:o=e.sent,e.next=18;break;case 7:return e.prev=7,e.t0=e.catch(1),e.prev=9,e.next=12,p.api.getGeoJson(i);case 12:o=e.sent,e.next=18;break;case 15:e.prev=15,e.t1=e.catch(9),console.error("Failed to fetch data",e.t1);case 18:u.properties.count=o["@iot.count"],p.addToCache(t,u),e.next=23;break;case 22:p.addToCache(t,u,!1);case 23:r(u);case 24:case"end":return e.stop()}}),e,null,[[1,7],[9,15]])})));return function(t,r){return e.apply(this,arguments)}}()))},c=o.lat;c<=i.lat;c++)u();return e.next=21,Promise.all(s);case 21:return e.sent.forEach(function(e){C(this,p),a.push(e)}.bind(this)),f=[],a.forEach(function(e){C(this,p),(e.properties.count<this.config.clusterMin||0==this.config.cluster)&&f.push(e.geometry.coordinates)}.bind(this)),e.next=27,this.getMarkers(f,t);case 27:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"getMarkers",value:(o=P(regeneratorRuntime.mark((function e(t,r){var n,o,i,a,s,l,u,c=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0==t.length){e.next=10;break}(n=JSON.parse(JSON.stringify(this.getQuery(r)))).top=1e3,"Things"==n.entityType?(n.expand||(n.expand=[]),(o=n.expand.find(function(e){return C(this,c),"Datastreams"==e.entityType}.bind(this)))?(o.select||(o.select=["id","name","unitOfMeasurement"]),o.select.includes("id")||o.select.push("id"),o.select.includes("name")||o.select.push("name"),o.select.includes("unitOfMeasurement")||o.select.push("unitOfMeasurement")):n.expand.push({entityType:"Datastreams",select:["id","name","unitOfMeasurement"],expand:[{entityType:"observedProperty"}]}),n.expand.some(function(e){return C(this,c),"Locations"==e.entityType}.bind(this))||n.expand.push({entityType:"Locations"})):(n.select&&!n.select.includes("feature")&&n.select.push("feature"),n.expand||(n.expand=[{entityType:"Observations",top:1,expand:[{entityType:"Datastream",select:["unitOfMeasurement","id"],expand:[{entityType:"observedProperty"}]}]}])),n.filter&&(n.filter="(".concat(n.filter,") and ")),i=[],a=A(t);try{for(a.s();!(s=a.n()).done;)l=s.value,(u=JSON.parse(JSON.stringify(n))).filter||(u.filter=""),u.filter+=H(l,u.entityType),i.push(new Promise(function(){var e=P(regeneratorRuntime.mark((function e(t,o){var i,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.api.getGeoJson(u);case 3:i=e.sent,e.next=17;break;case 6:return e.prev=6,e.t0=e.catch(0),e.prev=8,e.next=11,c.api.getGeoJson(u);case 11:i=e.sent,e.next=17;break;case 14:e.prev=14,e.t1=e.catch(8),console.error("Failed to fetch data",e.t1);case 17:i.value.forEach(function(e){var t,o=this;if(C(this,a),"Feature"!=(t="Things"==n.entityType?e.Locations[0].location:e.feature).type&&(t={type:"Feature",geometry:t,properties:t.properties}),delete e.Locations,t.properties=e,e.getData||(e.getData=[]),"Things"==n.entityType){var i,s=A(e.Datastreams);try{for(s.s();!(i=s.n()).done;){var l=i.value;c.addGetDataCallback(l,e)}}catch(e){s.e(e)}finally{s.f()}}else{var u=e.Observations[0].Datastream;c.addGetDataCallback(u,e)}c.getCached(r).features.some(function(e){return C(this,o),W(t,e)}.bind(this))||c.addToCache(r,t)}.bind(this)),t();case 19:case"end":return e.stop()}}),e,this,[[0,6],[8,14]])})));return function(t,r){return e.apply(this,arguments)}}()))}catch(e){a.e(e)}finally{a.f()}return e.next=10,Promise.all(i);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"addGetDataCallback",value:function(e,t){if(e){var r=e["@iot.id"],n=e.unitOfMeasurement;t.getData.push({observedProperty:e.ObservedProperty.name,getData:function(e){var t=this,o={entityType:"Datastreams",id:r,pathSuffix:"Observations"};return o=e(o),new Promise(function(){var e=P(regeneratorRuntime.mark((function e(r,i){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api.getGeoJson(o);case 2:(a=e.sent).unitOfMeasurement=n,r(a);case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}())}.bind(this)})}}},{key:"getCached",value:function(e){this.config.cachingDuration&&(this.cache=this.cache.filter(function(e){var t=new Date(e.timestamp);return t.setSeconds(e.timestamp.getSeconds()+this.config.cachingDuration),t>new Date}.bind(this)));var t,r={type:"FeatureCollection",features:[],zoom:e},n=A(this.cache);try{for(n.s();!(t=n.n()).done;){var o=t.value;o.zoom==e&&r.features.push(o.geoJson)}}catch(e){n.e(e)}finally{n.f()}return r}},{key:"addToCache",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.cache.push({geoJson:t,zoom:e,timestamp:new Date}),r&&this.emitChange(e)}},{key:"emitChange",value:function(e){var t=this,r=this.getCached(e);r.features=this.getCached(e).features.filter(function(e){var r,n,o;return C(this,t),null==(null===(r=e.properties)||void 0===r?void 0:r.count)||(0==this.config.cluster?null==(null===(n=e.properties)||void 0===n?void 0:n.count):(null===(o=e.properties)||void 0===o?void 0:o.count)>=this.config.clusterMin)}.bind(this)),this.emit("change",r)}}])&&M(t.prototype,r),n&&M(t,n),s}(l);function W(e,t){var r,n,o,i;return e.type==t.type&&((null===(r=e.properties)||void 0===r?void 0:r["@iot.id"])||(null===(n=t.properties)||void 0===n?void 0:n["@iot.id"])?(null===(o=e.properties)||void 0===o?void 0:o["@iot.id"])==(null===(i=t.properties)||void 0===i?void 0:i["@iot.id"]):e.coordinates?Z(e.coordinates,t.coordinates):Z(e.geometry.coordinates,t.geometry.coordinates))}function Z(e,t){if(!t)return!1;if(e.length!=t.length)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]instanceof Array&&t[r]instanceof Array){if(!Z(e[r],t[r]))return!1}else if(e[r]!=t[r])return!1;return!0}function H(e,t){var r=this;return e.map(function(e){var n=this;return C(this,r),null!=e[0][0][0]&&(e=e[0]),"geo.intersects(".concat("Things"==t?"Locations/location":"feature",",geography'POLYGON ((").concat(e.map(function(e){return C(this,n),e.join(" ")}.bind(this)).join(","),"))')")}.bind(this)).join(" or ")}function $(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}(e,t)||Q(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Y(e){return function(e){if(Array.isArray(e))return K(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Q(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Q(e,t){if(e){if("string"==typeof e)return K(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?K(e,t):void 0}}function K(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function X(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function ee(e,t){if(e!==t)throw new TypeError("Cannot instantiate an arrow function")}function te(e){return(te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}(ce(".loader{border:16px solid #f3f3f3;border-top:16px solid #3498db;border-radius:50%;width:60px;height:60px;left:0;right:0;top:0;margin:auto;bottom:0;position:fixed;animation:spin 2s linear infinite}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}"),"undefined"!=typeof L)&&(!function(e){if("object"===("undefined"==typeof exports?"undefined":te(exports))&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;((t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).L||(t.L={})).Realtime=e()}}((function(){return function e(t,r,n){function o(a,s){if(!r[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=r[a]={exports:{}};t[a][0].call(c.exports,(function(e){return o(t[a][1][e]||e)}),c,c.exports,e,t,r,n)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,r){L.Realtime=L.Layer.extend({options:{start:!0,interval:6e4,getFeatureId:function(e){return e.properties.id},updateFeature:function(e,t){if(t){var r=e.geometry&&e.geometry.type,n=e.geometry&&e.geometry.coordinates;switch(r){case"Point":t.setLatLng(L.GeoJSON.coordsToLatLng(n));break;case"LineString":case"MultiLineString":t.setLatLngs(L.GeoJSON.coordsToLatLngs(n,"LineString"===r?0:1));break;case"Polygon":case"MultiPolygon":t.setLatLngs(L.GeoJSON.coordsToLatLngs(n,"Polygon"===r?1:2));break;default:return null}return t}},logErrors:!0,cache:!1,removeMissing:!0,onlyRunWhenAdded:!1},initialize:function(e,t){L.setOptions(this,t),this._container=t.container||L.geoJson(null,t),"function"==typeof e?this._src=e:(this._fetchOptions=e&&e.url?e:{url:e},this._src=L.bind(this._defaultSource,this)),this._features={},this._featureLayers={},this._requestCount=0,this.options.start&&!this.options.onlyRunWhenAdded&&this.start()},start:function(){return this._timer||(this._timer=setInterval(L.bind(this.update,this),this.options.interval),this.update()),this},stop:function(){return this._timer&&(clearTimeout(this._timer),delete this._timer),this},isRunning:function(){return this._timer},setUrl:function(e){if(!this._fetchOptions)throw new Error("Custom sources does not support setting URL.");this._fetchOptions.url=e,this.update()},update:function(e){var t,r,n=++this._requestCount,o=L.bind((function(e){return L.bind((function(){if(n===this._requestCount)return e.apply(this,arguments)}),this)}),this);return e?this._onNewData(!1,e):(t=L.bind((function(e){this._onNewData(this.options.removeMissing,e)}),this),r=L.bind(this._onError,this),this._src(o(t),o(r))),this},remove:function(e){var t,r,n,o=L.Util.isArray(e)?e:e.features?e.features:[e],i={};for(t=0,r=o.length;t<r;t++)n=this.options.getFeatureId(o[t]),this._container.removeLayer(this._featureLayers[n]),i[n]=this._features[n],delete this._features[n],delete this._featureLayers[n];return this.fire("update",{features:this._features,enter:{},update:{},exit:i}),this},getLayer:function(e){return this._featureLayers[e]},getFeature:function(e){return this._features[e]},getBounds:function(){var e=this._container;if(e.getBounds)return e.getBounds();throw new Error("Container has no getBounds method")},onAdd:function(e){e.addLayer(this._container),this.options.start&&this.start()},onRemove:function(e){this.options.onlyRunWhenAdded&&this.stop(),e.removeLayer(this._container)},_onNewData:function(e,t){var r,n,o,i=[],a={},s={},l={},u={},c=L.bind((function(e){var t=L.Util.isArray(e)?e:e.features;if(t)for(r=0,n=t.length;r<n;r++)((o=t[r]).geometries||o.geometry||o.features||o.coordinates)&&c(o);else{var l=this._container,f=this.options;if(!f.filter||f.filter(e)){var p=L.GeoJSON.asFeature(e),h=f.getFeatureId(p),d=this._featureLayers[h],y=this.options.updateFeature(p,d);if(!y){if(!(y=L.GeoJSON.geometryToLayer(e,f)))return;y.defaultOptions=y.options,y.feature=p,f.onEachFeature&&f.onEachFeature(e,y),f.style&&y.setStyle&&y.setStyle(f.style(e))}y.feature=p,l.resetStyle&&l.resetStyle(y),d?(s[h]=e,d!=y&&(i.push(d),l.addLayer(y))):(a[h]=e,l.addLayer(y)),this._featureLayers[h]=y,this._features[h]=u[h]=p}}}),this);for(c(t),e&&(l=this._removeUnknown(u)),r=0;r<i.length;r++)this._container.removeLayer(i[r]);this.fire("update",{features:this._features,enter:a,update:s,exit:l})},_onError:function(e,t){this.options.logErrors&&console.warn(e,t),this.fire("error",{error:e,message:t})},_removeUnknown:function(e){var t,r={};for(t in this._featureLayers)e[t]||(this._container.removeLayer(this._featureLayers[t]),r[t]=this._features[t],delete this._featureLayers[t],delete this._features[t]);return r},_bustCache:function(e){return e+L.Util.getParamString({_:(new Date).getTime()},e)},_defaultSource:function(e,t){var r=this._fetchOptions,n=r.url;n=this.options.cache?n:this._bustCache(n),fetch(n,r).then((function(e){return e.json()})).then(e).catch(t)}}),L.realtime=function(e,t){return new L.Realtime(e,t)},t.exports=L.Realtime},{}]},{},[1])(1)})),L.Stam=L.LayerGroup.extend({initialize:function(e){var t,r=new V(e),n={type:"FeatureCollection",features:[]},o={default:{opacity:0,fillOpacity:0},highlight:{color:"red",opacity:1}},i=function(r){var n;t&&s(t);var i="function"==typeof e.clusterStyle?e.clusterStyle(r.feature).polygon.hover:null===(n=e.clusterStyle)||void 0===n?void 0:n.polygon.hover;ie(i),r.setStyle(null!=i?i:o.highlight),t=r},s=function(r){var n,i="function"==typeof e.clusterStyle?e.clusterStyle(r.feature).polygon.default:null===(n=e.clusterStyle)||void 0===n?void 0:n.polygon.default;ie(i),r.setStyle(null!=i?i:o.default),t=null};this.on("add",(function(){var l=this;if(null!=this._map){var u=this._map,c=u.getZoom();R=L.layerGroup();var f=function(t,r){var n;if(ee(this,l),"Polygon"==(null===(n=t.geometry)||void 0===n?void 0:n.type)&&t.properties.count){var a;r.on("mouseover",(function(){e.clusterMouseOver&&e.clusterMouseOver(t),i(r)})),r.on("mouseout",(function(){s(r)})),r.on("click",(function(){if(e.clusterClick)return e.clusterClick(t);u.fitBounds(r.getBounds())}));var c="function"==typeof e.clusterStyle?e.clusterStyle(r.feature).polygon.default:null===(a=e.clusterStyle)||void 0===a?void 0:a.polygon.default;ie(c),r.setStyle(null!=c?c:o.default);var f=r.getBounds(),p=(f._northEast.lat+f._southWest.lat)/2,h=(f._northEast.lng+f._southWest.lng)/2,d=L.circleMarker(L.latLng(p,h),{radius:127/3});d.bindTooltip("<span>".concat(t.properties.count,"</span>"),{permanent:!0,direction:"center",className:"count"}),R.addLayer(d)}else{var y=!0;r.on("click",(function(){if(r.getPopup())r.getPopup().openPopup();else{if(e.markerClick){var n=e.markerClick(t);n&&(y=!1,r.bindPopup(n).openPopup())}if(y){var o=document.createElement("div");ae(o,t,e),r.bindPopup(o).openPopup()}}})),r.on("mouseover",(function(){if(e.markerMouseOver)return e.markerMouseOver(t)}))}}.bind(this),p=function(t,r){var n=this;if("function"==typeof e.markerStyle&&"AsyncFunction"===e.markerStyle.constructor.name){var o=L.marker(r);return e.markerStyle(t).then(function(e){ee(this,n),o.setIcon(a(e))}.bind(this)),o}return o=L.marker(r,{icon:"function"==typeof e.markerStyle?a(e.markerStyle(t)):"string"==typeof e.markerStyle?a(e.markerStyle):new L.Icon.Default})},h=void 0;"function"==typeof e.polygonStyle?h=function(t){var r;if("Polygon"!=(null===(r=t.geometry)||void 0===r?void 0:r.type)||!t.properties.count)return e.polygonStyle(t)}:e.polygonStyle&&(h=function(t){var r;if("Polygon"!=(null===(r=t.geometry)||void 0===r?void 0:r.type)||!t.properties.count)return e.polygonStyle}),u.on("layeradd",(function(){u.off("layeradd"),q=L.realtime((function(e,t){e(n)}),{onEachFeature:f,pointToLayer:p,getFeatureId:function(e){if(t&&i(t),e.properties["@iot.id"])return e.properties["@iot.id"];var r=e.geometry.coordinates.flat(3);return e.properties.count?r.join("/"):"".concat(r[0],"/").concat(r[1])},style:h,interval:500}),this.addLayer(R),this.addLayer(q);var e=u.getBounds();r.getLayerData(u.getZoom(),[e._northEast.lng,e._northEast.lat,e._southWest.lng,e._southWest.lat])})),r.on("change",function(e){e.zoom==c&&(n=e)}.bind(this)),u.on("moveend",(function(){c!=u.getZoom()&&(c=u.getZoom(),R.clearLayers());var e=u.getBounds();r.getLayerData(u.getZoom(),[e._northEast.lng,e._northEast.lat,e._southWest.lng,e._southWest.lat])}))}}))}}),L.stam=function(e){return new L.Stam(e)},ce(".leaflet-tooltip.count {background-color: transparent;border: transparent;  box-shadow: none;  font-weight: bold;font-size: 20px;}"));if("undefined"!=typeof ol){ce('.ol-popup{position:absolute;min-width:180px;background-color:#fff;-webkit-filter:drop-shadow(0 1px 4px rgba(0, 0, 0, .2));filter:drop-shadow(0 1px 4px rgba(0, 0, 0, .2));padding:15px;border-radius:10px;border:1px solid #ccc;bottom:40px;left:-50px}.ol-popup:after,.ol-popup:before{top:100%;border:solid transparent;content:" ";height:0;width:0;position:absolute;pointer-events:none}.ol-popup:after{border-top-color:#fff;border-width:10px;left:48px;margin-left:-10px}.ol-popup:before{border-top-color:#ccc;border-width:11px;left:48px;margin-left:-11px}.ol-popup-closer{text-decoration:none;position:absolute;top:2px;right:8px}.ol-popup-closer:after{content:""}');var re,ne,oe=function(e){var t=this;ne=e.map,ol.layer.Group.call(this,e),re=ne.getView().getZoom().toFixed(0);var r=new V(e),n=!1,o=new ol.layer.Vector({source:new ol.source.Vector}),i=new ol.layer.Vector({source:new ol.source.Vector,style:function(t){var r=this;if(n&&(n=!1,o.getSource().clear()),"Point"==t.getGeometry().getType()){if("function"==typeof e.markerStyle&&"AsyncFunction"===e.markerStyle.constructor.name)return e.markerStyle(se(t)).then(function(e){ee(this,r),t.setStyle(new ol.style.Style({image:new ol.style.Icon({anchor:[.5,1],scale:.5,anchorXUnits:"fraction",anchorYUnits:"fraction",src:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-".concat(e,".png")})}))}.bind(this)),null;y=new ol.style.Style({image:new ol.style.Icon({anchor:[.5,1],scale:.5,anchorXUnits:"fraction",anchorYUnits:"fraction",src:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-".concat("function"==typeof e.markerStyle?e.markerStyle(se(t)):e.markerStyle?e.markerStyle:"blue",".png")})});return y}var i,a,s,l=t.getGeometry().getExtent(),u=(l[0]+l[2])/2,c=(l[1]+l[3])/2,f=(y="function"==typeof e.clusterStyle?e.clusterStyle(se(t)):e.clusterStyle,null===(i=y)||void 0===i?void 0:i.circle),p=null===(a=y)||void 0===a?void 0:a.polygon.default;if(null!=t.get("count")){var h=new ol.Feature({geometry:new ol.geom.Circle([u,c],(l[2]-l[0])/6),name:"cluster"}),d=new ol.style.Text({font:"30px Calibri,sans-serif",fill:new ol.style.Fill({color:"#000"}),stroke:new ol.style.Stroke({color:"#fff",width:2}),text:"".concat(t.get("count"))});if(f){var y=le(f);y.setText(d),h.setStyle(y)}else h.setStyle(new ol.style.Style({stroke:new ol.style.Stroke({width:2,color:"red",radius:1}),text:d}));o.getSource().addFeature(h)}return p&&(p=le(p)),null!==(s=p)&&void 0!==s?s:new ol.style.Style({stroke:new ol.style.Stroke({color:"#3399CC",width:1.25}),fill:new ol.style.Fill({color:"rgba(255,255,255,0.4)"})})}}),a=new ol.layer.Group({layers:[o,i]});ne.addLayer(a);var s=new ol.format.GeoJSON({featureProjection:ne.getView().getProjection().getCode()});r.on("change",function(e){ee(this,t),e.zoom==re&&(i.getSource().clear(),n=!0,i.getSource().addFeatures(s.readFeatures(e)))}.bind(this)),document.getElementById("popup")||document.writeln('<div id="popup" class="ol-popup">\n      <a href="#" id="popup-closer" class="ol-popup-closer"></a>\n      <div id="popup-content"></div>\n      </div>');var l=document.getElementById("popup"),u=document.getElementById("popup-content"),c=document.getElementById("popup-closer");c.onclick=function(){return f.setPosition(void 0),c.blur(),!1};var f=new ol.Overlay({element:l,autoPan:!0,offset:[0,-10]});ne.addOverlay(f);var p=null,h=new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255,255,255,0.7)"}),stroke:new ol.style.Stroke({color:"#3399CC",width:3})}),d=null;ne.on("pointermove",(function(t){if(ne.forEachFeatureAtPixel(t.pixel,(function(t){if(t.get("count")){var r;if(d!=t&&(d=t,e.clusterMouseOver&&e.clusterMouseOver(se(t))),p!=t)null===(r=p)||void 0===r||r.setStyle(void 0),p=t;if(e.clusterStyle)n=le("function"==typeof e.clusterStyle?e.clusterStyle(se(t)).polygon.hover:e.clusterStyle.polygon.hover);else var n=h;t.setStyle(n)}else t.get("@iot.id")&&d!=t&&(d=t,e.markerMouseOver&&e.markerMouseOver(se(t)));return t})))this.getTargetElement().style.cursor="pointer";else{var r;if(p)null===(r=p)||void 0===r||r.setStyle(void 0),p=null;this.getTargetElement().style.cursor=""}})),ne.on("click",(function(t){var r=ne.forEachFeatureAtPixel(t.pixel,(function(e){return e}));if(r)if(null!=r.get("@iot.id")){var n,o=r.getGeometry();if("function"==typeof e.markerClick&&(n=e.markerClick(se(r))),n?u.innerHTML=n:ae(u,se(r),e),"Point"==o.getType())f.setPosition(o.getCoordinates());else{var i=t.pixel;i[1]=i[1]+36,f.setPosition(ne.getCoordinateFromPixel(i))}}else null!=r.get("count")&&("function"==typeof e.clusterClick?null==e||e.clusterClick(se(r)):ne.getView().fit(r.getGeometry().getExtent(),ne.getSize(),{duration:1e3}))})),ne.on("moveend",(function(){re!=ne.getView().getZoom()&&(re=ne.getView().getZoom().toFixed(0)),function(e,t,r,n){var o;if("EPSG:4326"==ne.getView().getProjection().getCode())o=ne.getView().calculateExtent();else{var i,a,s=ne.getView().calculateExtent(),l=ne.getView().getProjection().getCode();(i=o=[]).push.apply(i,Y(new ol.geom.Point([s[2],s[3]]).transform(l,"EPSG:4326").getCoordinates())),(a=o).push.apply(a,Y(new ol.geom.Point([s[0],s[1]]).transform(l,"EPSG:4326").getCoordinates()))}e.getLayerData(t,o)}(r,re)}))};J=oe,B=ol.layer.Group,J.prototype=Object.create(B.prototype),J.prototype.constructor=J,ol.layer.STAM=oe}function ie(e){e&&!e.fillColor&&(e.fillColor="rgba(255,0,0,0.0)")}function ae(e,t,r){e.innerHTML="<h3>"+t.properties.name+"</h3>";var n=document.createElement("ul");t.properties.getData.forEach((function(e){var t=document.createElement("li");t.innerText=e.observedProperty,t.setAttribute("style","cursor: pointer"),"undefined"!=typeof Plotly&&(t.onclick=function(){o({width:"70%",content:"",modalId:"pico-1"}).beforeClose((function(){Plotly.purge("pico-1"),document.getElementById("pico-1").remove()})).afterShow(function(){var t,n=(t=regeneratorRuntime.mark((function t(n){var o,i,a,s,l,u,c,f,p=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.modalElem().style.overflow="hidden",n.modalElem().style.height="50%",(o=document.createElement("div")).classList.add("loader"),n.modalElem().appendChild(o),i=!1,t.next=8,e.getData((function(e){if(e.resultFormat="dataArray",e.orderby="phenomenonTime asc",r.plot){var t="gt";r.plot.offset?(e.top=Math.abs(r.plot.offset),-1==Math.sign(r.plot.offset)&&(i=!0,e.orderby="phenomenonTime desc",t="lt"),e.filter="phenomenonTime ".concat(t," ").concat(r.plot.startDate.toISOString())):r.plot.endDate&&(e.filter="(phenomenonTime gt ".concat(r.plot.startDate.toISOString(),") and (phenomenonTime lt ").concat(r.plot.endDate.toISOString(),")"))}return e}));case 8:a=t.sent,s=[],l=[],u=a.value,i&&(u.dataArray=u.dataArray.reverse()),u.dataArray&&u.dataArray.forEach(function(e){ee(this,p),-1!=e[1].indexOf("/")?(s.push(e[1].split("/")[0]),s.push(e[1].split("/")[1]),l.push(e[2])):s.push(e[1]),l.push(e[2])}.bind(this)),c=[{x:s,y:l,type:"scatter"}],f={xaxis:{autorange:!0},yaxis:{autorange:!0,title:{text:a.unitOfMeasurement.name}},autosize:!0},o.remove(),Plotly.newPlot("pico-1",c,f,{responsive:!0});case 19:case"end":return t.stop()}}),t,this)})),function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(e){X(i,n,o,a,s,"next",e)}function s(e){X(i,n,o,a,s,"throw",e)}a(void 0)}))});return function(e){return n.apply(this,arguments)}}()).show()}),n.appendChild(t)})),e.appendChild(n)}function se(e){return{type:e.getGeometry().getType(),properties:e.getProperties(),geometry:{type:"Point",coordinates:e.getGeometry().getCoordinates()}}}function le(e){var t,r;return new ol.style.Style({stroke:new ol.style.Stroke({color:ue(null!==(t=e.color)&&void 0!==t?t:"red",e.opacity),width:null!==(r=e.weight)&&void 0!==r?r:1}),fill:new ol.style.Fill({color:e.fillColor?ue(e.fillColor,e.fillOpacity):"rgba(0, 0, 0, 0)"})})}function ue(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=Array.from(ol.color.asArray(e)),n=$(r,3),o=n[0],i=n[1],a=n[2];return ol.color.asString([o,i,a,t])}function ce(e){var t=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");t.appendChild(r),r.type="text/css",r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}}));
//# sourceMappingURL=stam.min.js.map
